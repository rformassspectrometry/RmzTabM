<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create the mzTab-M Small Molecule Feature (SMF) Table — smf_create • RmzTabM</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create the mzTab-M Small Molecule Feature (SMF) Table — smf_create"><meta name="description" content='The Small Molecule Feature (SMF) section of the mzTab-M definition captures
information on the individual MS features (quantified regions, e.g.,
elution profiles of specific m/z and retention times) that were measured
across the assays.
smf_create() provides a simplified workflow to generate this table in a
single step. It takes a matrix of abundances (rows=features, columns=assays)
and optional vectors defining feature properties.
It automatically:
Formats the abundance matrix (renaming columns to abundance_assay[n]).
Adds the required SMF_ID and standard mzTab-M columns (e.g.,
exp_mass_to_charge).
Populates missing mandatory columns with "null" strings to ensure
compliance.
Sets the line prefix column SFH to "SMF".
Orders columns according to the mzTab-M specification.


Important: to support the optional additional parameters passed along
with ... all parameters (such as adduct_ion,
retention_time_in_seconds etc) have to be fully spelled out. All
parameters are vectorized and recycled as needed to match the number of rows
in the abundance matrix, if their length is not equal to the number of rows
or 1, an error is raised.
See also the specification of the SMF section
for details.'><meta property="og:description" content='The Small Molecule Feature (SMF) section of the mzTab-M definition captures
information on the individual MS features (quantified regions, e.g.,
elution profiles of specific m/z and retention times) that were measured
across the assays.
smf_create() provides a simplified workflow to generate this table in a
single step. It takes a matrix of abundances (rows=features, columns=assays)
and optional vectors defining feature properties.
It automatically:
Formats the abundance matrix (renaming columns to abundance_assay[n]).
Adds the required SMF_ID and standard mzTab-M columns (e.g.,
exp_mass_to_charge).
Populates missing mandatory columns with "null" strings to ensure
compliance.
Sets the line prefix column SFH to "SMF".
Orders columns according to the mzTab-M specification.


Important: to support the optional additional parameters passed along
with ... all parameters (such as adduct_ion,
retention_time_in_seconds etc) have to be fully spelled out. All
parameters are vectorized and recycled as needed to match the number of rows
in the abundance matrix, if their length is not equal to the number of rows
or 1, an error is raised.
See also the specification of the SMF section
for details.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RmzTabM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.97.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/rmztabm-api.html">The R API for the mzTab-M File Format</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/RmzTabM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create the mzTab-M Small Molecule Feature (SMF) Table</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/RmzTabM/blob/main/R/SMF.R" class="external-link"><code>R/SMF.R</code></a></small>
      <div class="d-none name"><code>smf_create.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The Small Molecule Feature (SMF) section of the mzTab-M definition captures
information on the individual MS features (quantified regions, e.g.,
elution profiles of specific <em>m/z</em> and retention times) that were measured
across the assays.</p>
<p><code>smf_create()</code> provides a simplified workflow to generate this table in a
single step. It takes a matrix of abundances (rows=features, columns=assays)
and optional vectors defining feature properties.</p>
<p>It automatically:</p><ul><li><p>Formats the abundance matrix (renaming columns to <code>abundance_assay[n]</code>).</p></li>
<li><p>Adds the required <code>SMF_ID</code> and standard mzTab-M columns (e.g.,
<code>exp_mass_to_charge</code>).</p></li>
<li><p>Populates missing mandatory columns with <code>"null"</code> strings to ensure
compliance.</p></li>
<li><p>Sets the line prefix column <code>SFH</code> to <code>"SMF"</code>.</p></li>
<li><p>Orders columns according to the mzTab-M specification.</p></li>
</ul><p><strong>Important:</strong> to support the optional additional parameters passed along
with <code>...</code> <strong>all</strong> parameters (such as <code>adduct_ion</code>,
<code>retention_time_in_seconds</code> etc) have to be <strong>fully</strong> spelled out. All
parameters are vectorized and recycled as needed to match the number of rows
in the abundance matrix, if their length is not equal to the number of rows
or 1, an error is raised.</p>
<p>See also the <a href="https://github.com/HUPO-PSI/mzTab-M/blob/main/specification_documents/mzTab_format_specification_2_1-M.adoc#64-small-molecule-feature-smf-section" class="external-link">specification of the SMF section</a>
for details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">smf_create</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">smf_df</span>,</span>
<span>  exp_mass_to_charge <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  retention_time_in_seconds <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  retention_time_in_seconds_start <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  retention_time_in_seconds_end <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  SME_ID_REFS <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  SME_ID_REF_ambiguity_code <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  charge <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  adduct_ion <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  isotopomer <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional optional columns to add. These arguments must be named.
The function will automatically prepend <code>"opt_"</code> to the names if not
already present.</p></dd>


<dt id="arg-smf-df">smf_df<a class="anchor" aria-label="anchor" href="#arg-smf-df"></a></dt>
<dd><p><code>matrix</code> or <code>data.frame</code> of abundances. Rows are features,
columns are assays. The order of columns is assumed to match the order of
assays defined in the Metadata (MTD) section.</p></dd>


<dt id="arg-exp-mass-to-charge">exp_mass_to_charge<a class="anchor" aria-label="anchor" href="#arg-exp-mass-to-charge"></a></dt>
<dd><p><code>numeric</code> vector of experimental m/z values.
<strong>Cannot</strong> be <code>NULL</code>.</p></dd>


<dt id="arg-retention-time-in-seconds">retention_time_in_seconds<a class="anchor" aria-label="anchor" href="#arg-retention-time-in-seconds"></a></dt>
<dd><p><code>numeric</code> vector of retention times in
seconds. Defaults to <code>"null"</code>.</p></dd>


<dt id="arg-retention-time-in-seconds-start">retention_time_in_seconds_start<a class="anchor" aria-label="anchor" href="#arg-retention-time-in-seconds-start"></a></dt>
<dd><p><code>numeric</code> vector of start retention
times in seconds. Defaults to <code>"null"</code>.</p></dd>


<dt id="arg-retention-time-in-seconds-end">retention_time_in_seconds_end<a class="anchor" aria-label="anchor" href="#arg-retention-time-in-seconds-end"></a></dt>
<dd><p><code>numeric</code> vector of end retention times
in seconds. Defaults to <code>"null"</code>.</p></dd>


<dt id="arg-sme-id-refs">SME_ID_REFS<a class="anchor" aria-label="anchor" href="#arg-sme-id-refs"></a></dt>
<dd><p><code>character</code> vector of SME IDs referencing small molecules.
Defaults to <code>"null"</code>.</p></dd>


<dt id="arg-sme-id-ref-ambiguity-code">SME_ID_REF_ambiguity_code<a class="anchor" aria-label="anchor" href="#arg-sme-id-ref-ambiguity-code"></a></dt>
<dd><p><code>character</code> vector of ambiguity codes for
SME ID references. Defaults to <code>"null"</code>.</p></dd>


<dt id="arg-charge">charge<a class="anchor" aria-label="anchor" href="#arg-charge"></a></dt>
<dd><p><code>integer</code> vector of charge states. Defaults to <code>"null"</code>.</p></dd>


<dt id="arg-adduct-ion">adduct_ion<a class="anchor" aria-label="anchor" href="#arg-adduct-ion"></a></dt>
<dd><p><code>character</code> vector of adducts (e.g. <code>"[M+H]+"</code>).
Defaults to <code>"null"</code>.</p></dd>


<dt id="arg-isotopomer">isotopomer<a class="anchor" aria-label="anchor" href="#arg-isotopomer"></a></dt>
<dd><p><code>character</code> vector for isotopomer description.
Defaults to <code>"null"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A complete SMF <code>data.frame</code> ready for export. The data frame contains
the 'SFH' line prefix, standard columns ordered according to spec,
abundance columns, and any optional columns.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Philippine Louail</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Assume we have a matrix of abundances (e.g., from xcms or similar tools)</span></span></span>
<span class="r-in"><span><span class="co">## Rows are features, Columns are Samples/Assays.</span></span></span>
<span class="r-in"><span><span class="va">abund_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100.1</span>, <span class="fl">105.2</span>, <span class="fl">110.3</span>,</span></span>
<span class="r-in"><span>      <span class="fl">200.5</span>, <span class="fl">198.2</span>, <span class="fl">201.0</span>,</span></span>
<span class="r-in"><span>      <span class="fl">50.0</span>, <span class="fl">55.0</span>, <span class="fl">52.1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Define feature metadata (vectors must match number of rows in matrix)</span></span></span>
<span class="r-in"><span><span class="va">mz_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150.05</span>, <span class="fl">200.10</span>, <span class="fl">300.15</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rt_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20.5</span>, <span class="fl">35.1</span>, <span class="fl">40.0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adducts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span>, <span class="st">"[M+H]+"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create the final dataframe ready for export</span></span></span>
<span class="r-in"><span><span class="co">## Note: Fields not provided (like charge) are automatically set to "null"</span></span></span>
<span class="r-in"><span><span class="va">smf_final</span> <span class="op">&lt;-</span> <span class="fu">smf_create</span><span class="op">(</span></span></span>
<span class="r-in"><span>    smf_df <span class="op">=</span> <span class="va">abund_mat</span>,</span></span>
<span class="r-in"><span>    exp_mass_to_charge <span class="op">=</span> <span class="va">mz_values</span>,</span></span>
<span class="r-in"><span>    retention_time_in_seconds <span class="op">=</span> <span class="va">rt_values</span>,</span></span>
<span class="r-in"><span>    adduct_ion <span class="op">=</span> <span class="va">adducts</span>,</span></span>
<span class="r-in"><span>    <span class="co">## Optional custom column example</span></span></span>
<span class="r-in"><span>    global_custom_attribute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The result contains the 'SFH' line prefix, standard columns, and</span></span></span>
<span class="r-in"><span><span class="co">## abundances</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">smf_final</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SFH SMF_ID SME_ID_REFS SME_ID_REF_ambiguity_code adduct_ion isotopomer</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 SMF      1        null                      null     [M+H]+       null</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 SMF      2        null                      null    [M+Na]+       null</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 SMF      3        null                      null     [M+H]+       null</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   exp_mass_to_charge charge retention_time_in_seconds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1             150.05   null                      20.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2              200.1   null                      35.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3             300.15   null                        40</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   retention_time_in_seconds_start retention_time_in_seconds_end</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                            null                          null</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                            null                          null</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                            null                          null</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   abundance_assay[1] abundance_assay[2] abundance_assay[3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1              100.1              105.2              110.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2              200.5              198.2              201.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3               50.0               55.0               52.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   opt_global_custom_attribute</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                           A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                           B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                           C</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nils Hoffmann, Steffen Neumann, Johannes Rainer, Philippine Louail.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

    </footer></div>





  </body></html>

